USE DATABASE DATAWAREHOUSE;


--Silver Layer Checks


--Customers: duplicates or NULL primary keys
SELECT 
  CST_ID,
  COUNT(*) AS cnt
FROM SILVER.CRM_CUST_INFO
GROUP BY CST_ID
HAVING COUNT(*) > 1 OR CST_ID IS NULL;

--Products: duplicates or NULL primary keys
SELECT 
  PRD_ID,
  COUNT(*) AS cnt
FROM SILVER.CRM_PRD_INFO
GROUP BY PRD_ID
HAVING COUNT(*) > 1 OR PRD_ID IS NULL;

--Products: negative/NULL costs
SELECT *
FROM SILVER.CRM_PRD_INFO
WHERE PRD_COST < 0 OR PRD_COST IS NULL;

--Products: invalid date ranges (end < start)
SELECT *
FROM SILVER.CRM_PRD_INFO
WHERE PRD_END_DT < PRD_START_DT;

--Sales: invalid date ordering
SELECT *
FROM SILVER.CRM_SALES_DETAILS
WHERE SLS_ORDER_DT > SLS_SHIP_DT
   OR SLS_ORDER_DT > SLS_DUE_DT;

--Sales: sales â‰  quantity * price, or bad values
SELECT DISTINCT
  SLS_SALES, SLS_QUANTITY, SLS_PRICE
FROM SILVER.CRM_SALES_DETAILS
WHERE SLS_SALES != SLS_QUANTITY * SLS_PRICE
   OR SLS_SALES IS NULL
   OR SLS_QUANTITY IS NULL
   OR SLS_PRICE IS NULL
   OR SLS_SALES <= 0
   OR SLS_QUANTITY <= 0
   OR SLS_PRICE <= 0;


--Gold Layer Checks

--Dim_customers: surrogate key uniqueness
SELECT CUSTOMER_KEY, COUNT(*) AS duplicate_count
FROM GOLD.DIM_CUSTOMERS
GROUP BY CUSTOMER_KEY
HAVING COUNT(*) > 1;

--Dim_products: surrogate key uniqueness
SELECT PRODUCT_KEY, COUNT(*) AS duplicate_count
FROM GOLD.DIM_PRODUCTS
GROUP BY PRODUCT_KEY
HAVING COUNT(*) > 1;

-- Fact_sales: orphaned foreign keys
SELECT *
FROM GOLD.FACT_SALES F
LEFT JOIN GOLD.DIM_CUSTOMERS C ON C.CUSTOMER_KEY = F.CUSTOMER_KEY
LEFT JOIN GOLD.DIM_PRODUCTS  P ON P.PRODUCT_KEY = F.PRODUCT_KEY
WHERE C.CUSTOMER_KEY IS NULL OR P.PRODUCT_KEY IS NULL;
